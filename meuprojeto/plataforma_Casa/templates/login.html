{% load static %}
<!--
    ============================================================================
    TEMPLATE DE AUTENTICAÇÃO - LOGIN
    ============================================================================
    
    Descrição:
    Página de autenticação para usuários existentes do sistema.
    Implementa interface de formulário de login responsiva e acessível.
    
    Funcionalidades Principais:
    - Autenticação por matrícula ou email
    - Toggle de visualização de senha
    - Opção "Lembrar-me" para manter sessão
    - Validação de credenciais pelo Django
    - Design responsivo com Bootstrap 5.3
    - Integração com Font Awesome para ícones
    
    Segurança:
    - CSRF token obrigatório em formulário POST
    - Proteção contra força bruta via Django-ratelimit (configurável em settings)
    - Sem armazenamento de senhas em sessão
    - Envio de credenciais apenas via HTTPS em produção
    
    Fluxo de Usuário:
    1. Usuário insere credenciais (matrícula/email + password)
    2. Django autentica credenciais no backend configurado
    3. Se sucesso: redireciona para dashboard baseado em perfil (aluno/monitor/professor/admin)
    4. Se falha: exibe mensagem de erro e permite nova tentativa
    5. Novo usuário pode acessar link de registro
    
    Dependências:
    - Bootstrap 5.3.0 (CDN)
    - Font Awesome 6.4.0 (CDN)
    - Django Template Tags (load static)
    - Django Messages Framework
    
    Autor: Equipe de Desenvolvimento - Plataforma Casa
    Data: Outubro 2025
    ============================================================================
-->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- Meta tags essenciais para compatibilidade e responsividade -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Plataforma Casa</title>
    
    <!-- Favicon - Ícone que aparece na aba do navegador -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512'><path fill='%23F5AC00' d='M320 32c-8.1 0-16.1 1.4-23.7 4.1L15.8 137.4C6.3 140.9 0 149.9 0 160s6.3 19.1 15.8 22.6l57.9 20.9C57.3 229.3 48 259.8 48 291.9v28.1c0 28.4-10.8 57.7-22.3 80.8c-6.5 13-13.9 25.8-22.5 37.6C0 442.7-.9 448.3 .9 453.4s6 8.9 11.2 10.2l64 16c4.2 1.1 8.7 .3 12.4-2s6.3-6.1 7.1-10.4c8.6-42.8 4.3-81.2-2.1-108.7C90.3 344.3 86 329.8 80 316.5V291.9c0-30.2 10.2-58.7 27.9-81.5c12.9-15.5 29.6-28 49.2-35.7l157-61.7c8.2-3.2 17.5 .8 20.7 9s-.8 17.5-9 20.7l-157 61.7c-12.4 4.9-23.3 12.4-32.2 21.6l159.6 57.6c7.6 2.7 15.6 4.1 23.7 4.1s16.1-1.4 23.7-4.1L624.2 182.6c9.5-3.4 15.8-12.5 15.8-22.6s-6.3-19.1-15.8-22.6L343.7 36.1C336.1 33.4 328.1 32 320 32zM128 408c0 35.3 86 72 192 72s192-36.7 192-72L496.7 262.6 354.5 314c-11.1 4-22.8 6-34.5 6s-23.5-2-34.5-6L143.3 262.6 128 408z'/></svg>" type="image/svg+xml">
    
    <!-- Bootstrap 5.3.0 - Framework CSS responsivo e componentes de UI -->
    <!-- Fornece grid system, componentes predefinidos e estilos padrão -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <!-- Font Awesome 6.4.0 - Biblioteca de ícones vetoriais escaláveis -->
    <!-- Utilizado para ícones de interface (usuário, chave, etc) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /*
         * ========================================================================
         * ESTILOS DE RESET E BASE
         * ========================================================================
         * Remove estilos padrão do navegador para garantir consistência visual
         */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* Inclui padding/border no cálculo de width/height */
        }
        
        /*
         * ========================================================================
         * BODY - CONTENEDOR PRINCIPAL
         * ========================================================================
         * Configuração do fundo e layout vertical centralizado
         * Utiliza flexbox para centralizar o formulário de login na tela
         */
        body {
            background: #f5f5f2;                    /* Cor off-white - fundo institucional */
            min-height: 100vh;                      /* Ocupa altura total da viewport */
            display: flex;                          /* Ativa flexbox */
            align-items: center;                    /* Centra verticalmente */
            justify-content: center;                /* Centra horizontalmente */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /*
         * ========================================================================
         * CONTAINER DE LOGIN
         * ========================================================================
         * Card principal com formulário de autenticação
         * Limitado a 400px de largura para melhor UX em inputs
         */
        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            background: #fafaf8;                    /* Fundo card - branco institucional */
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border-top: 5px solid #F5AC00;          /* Borda amarela CASA - identidade visual */
        }
        
        /*
         * ========================================================================
         * HEADER DO LOGIN
         * ========================================================================
         * Seção contendo ícone, título e subtítulo do login
         */
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        /* Ícone de formatura - visual identitário */
        .login-header i {
            font-size: 3rem;
            color: #F5AC00;                         /* Amarelo CASA */
            margin-bottom: 1rem;
        }
        
        /* Título principal da página */
        .login-header h1 {
            color: #002555;                         /* Azul escuro CASA */
            font-size: 1.8rem;
            font-weight: 700;                       /* Negrito forte para hierarquia */
            margin-bottom: 0.5rem;
        }
        
        /* Subtítulo descritivo */
        .login-header p {
            color: #6d6e71;                         /* Cinza-médio para contraste */
            font-size: 0.9rem;
        }
        
        /*
         * ========================================================================
         * GRUPOS DE FORMULÁRIO
         * ========================================================================
         * Espaçamento e layout para campos do formulário
         */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        /* Labels do formulário - identificação clara dos campos */
        .form-group label {
            color: #002555;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        /* Inputs de texto - username e password */
        .form-group input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid #d1d3d4;              /* Borda cinza leve */
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;              /* Suaviza transição de focus */
            background: #ffffff;
            color: #6d6e71;
        }
        
        /* Estado de foco - feedback visual ao usuário */
        .form-group input:focus {
            border-color: #002555;                  /* Muda para azul escuro */
            outline: none;                          /* Remove outline padrão */
            box-shadow: 0 0 0 3px rgba(0, 37, 85, 0.1); /* Sombra sutil azulada */
            background: #ffffff;
        }
        
        /* Placeholder text - dicas de preenchimento */
        .form-group input::placeholder {
            color: #a7a9ab;                         /* Cinza claro */
        }
        
        /*
         * ========================================================================
         * BOTÃO DE SUBMIT
         * ========================================================================
         * Estilo do botão de entrada com gradiente e efeitos de interação
         */
        .login-btn {
            width: 100%;
            padding: 0.9rem 1rem;
            background: linear-gradient(135deg, #002555 0%, #1245FF 100%);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        
        /* Efeito hover - elevação do botão */
        .login-btn:hover {
            transform: translateY(-2px);            /* Move 2px para cima */
            box-shadow: 0 5px 20px rgba(0, 37, 85, 0.3);
        }
        
        /* Estado ativo - gradiente inverso */
        .login-btn:active {
            background: linear-gradient(135deg, #1245FF 0%, #002555 100%);
        }
        
        /*
         * ========================================================================
         * ALERTAS - MENSAGENS DO SISTEMA
         * ========================================================================
         * Feedback de erros e sucessos
         */
        .alert {
            margin-bottom: 1rem;
            border-radius: 8px;
            border: none;
            padding: 1rem;
        }
        
        /* Alerta de erro - credenciais inválidas, etc */
        .alert-danger {
            background: #f8d7da;                    /* Fundo rosa pálido */
            color: #721c24;                         /* Texto vermelho escuro */
        }
        
        /* Alerta de sucesso - login após mudança de senha, etc */
        .alert-success {
            background: #d4edda;                    /* Fundo verde pálido */
            color: #155724;                         /* Texto verde escuro */
        }
        
        /*
         * ========================================================================
         * OPÇÃO "LEMBRAR-ME"
         * ========================================================================
         * Checkbox para manter sessão do usuário
         */
        .remember-me {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        
        /* Checkbox customizado */
        .remember-me input {
            margin-right: 0.5rem;
            width: auto;
            border: none;
            cursor: pointer;
        }
        
        /* Label do checkbox */
        .remember-me label {
            margin: 0;
            color: #6d6e71;
            font-size: 0.9rem;
            font-weight: 400;
            cursor: pointer;
        }
        
        /*
         * ========================================================================
         * FOOTER DO LOGIN
         * ========================================================================
         * Seção inferior com link para novo registro
         */
        .login-footer {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #d1d3d4;
            color: #6d6e71;
            font-size: 0.9rem;
        }
        
        /* Links internos no footer */
        .login-footer a {
            color: #002555;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        /* Hover em links do footer */
        .login-footer a:hover {
            color: #F5AC00;                         /* Muda para amarelo CASA */
        }
        
        /*
         * ========================================================================
         * SENHA ESQUECIDA
         * ========================================================================
         * Link para recuperação de senha
         */
        .forgot-password {
            text-align: right;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
        }
        
        /* Link de "Esqueceu a senha?" */
        .forgot-password a {
            color: #002555;
            font-size: 0.85rem;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        /* Hover no link de senha */
        .forgot-password a:hover {
            color: #F5AC00;
        }
        
        /*
         * ========================================================================
         * INPUTS COM ÍCONES
         * ========================================================================
         * Estrutura para posicionar ícones dentro dos inputs
         */
        .input-group {
            position: relative;
        }
        
        /* Ícone dentro do input (esquerda) */
        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6d6e71;
            z-index: 10;                            /* Fica acima do input */
        }
        
        /* Input com espaço para ícone na esquerda */
        .input-group input {
            padding-left: 40px;                     /* Espaço para ícone */
        }
        
        /*
         * ========================================================================
         * TOGGLE DE VISUALIZAÇÃO DE SENHA
         * ========================================================================
         * Botão para mostrar/ocultar senha digitada
         */
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6d6e71;
            cursor: pointer;
            z-index: 10;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        
        /* Hover no ícone de toggle */
        .password-toggle:hover {
            color: #002555;                         /* Muda para azul escuro */
        }
        
        /* Input password com espaço para ícone na direita */
        .input-group.password-field input {
            padding-right: 40px;                    /* Espaço para ícone de olho */
        }
        
        /*
         * ========================================================================
         * RESPONSIVIDADE - MOBILE
         * ========================================================================
         * Ajustes para telas pequenas (< 768px)
         */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            
            .login-container {
                padding: 1.25rem;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                max-width: 100%;
            }
            
            .login-header {
                margin-bottom: 1.25rem;
            }
            
            .login-header i {
                font-size: 2rem;
                margin-bottom: 0.75rem;
            }
            
            .login-header h1 {
                font-size: 1.35rem;
                margin-bottom: 0.35rem;
            }
            
            .login-header p {
                font-size: 0.8rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
            
            .form-group label {
                font-size: 0.85rem;
                margin-bottom: 0.35rem;
            }
            
            .form-group input {
                padding: 0.65rem 0.85rem;
                font-size: 0.875rem;
                border-radius: 6px;
            }
            
            .input-icon {
                font-size: 0.875rem;
                width: 35px;
            }
            
            .input-group input {
                padding-left: 2.25rem;
            }
            
            .password-toggle {
                width: 35px;
                font-size: 0.875rem;
            }
            
            .input-group.password-field input {
                padding-right: 2.25rem;
            }
            
            .login-btn {
                padding: 0.7rem 0.85rem;
                font-size: 0.9rem;
                margin-top: 0.75rem;
            }
            
            .remember-me {
                font-size: 0.8rem;
                margin-bottom: 0.75rem;
            }
            
            .forgot-password {
                font-size: 0.8rem;
                margin-bottom: 0.75rem;
            }
            
            .login-footer {
                margin-top: 1.25rem;
                padding-top: 1.25rem;
                font-size: 0.85rem;
            }
            
            .login-footer .btn {
                padding: 0.65rem 0.85rem !important;
                font-size: 0.875rem !important;
            }
            
            .alert {
                font-size: 0.85rem;
                padding: 0.65rem;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Container principal que centraliza o formulário de login -->
    <div class="login-container">
        
        <!-- 
            ====================================================================
            SEÇÃO DE HEADER DO LOGIN
            ====================================================================
            Contém ícone visual, título e subtítulo do formulário de autenticação
            Proporciona contexto e identidade visual ao usuário
        -->
        <div class="login-header">
            <i class="fas fa-graduation-cap"></i>  <!-- Ícone de formatura - identidade da plataforma -->
            <h1>Plataforma Casa</h1>               <!-- Título principal -->
            <p>Sistema de Monitorias</p>           <!-- Subtítulo descritivo -->
        </div>
        
        <!-- 
            ====================================================================
            SISTEMA DE MENSAGENS DO DJANGO
            ====================================================================
            Exibe alertas de erro (credenciais inválidas) ou aviso de logout
            Utiliza o messages framework do Django para feedback do usuário
        -->
        {% if messages %}
            {% for message in messages %}
                <!-- Alerta customizado com classe de tag (danger/success/warning/info) -->
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <!-- Botão de fechar para descartar alerta -->
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <!-- 
            ====================================================================
            FORMULÁRIO DE AUTENTICAÇÃO
            ====================================================================
            Formulário POST com validação CSRF do Django
            Envia credenciais para a view de login (settings.LOGIN_URL)
        -->
        <form method="POST" class="login-form">
            <!-- CSRF Token - proteção contra cross-site request forgery -->
            {% csrf_token %}
            {% if request.GET.next %}
                <input type="hidden" name="next" value="{{ request.GET.next }}">
            {% endif %}
            
            <!-- 
                CAMPO: USERNAME OU EMAIL
                Aceita tanto nome de usuário quanto email para maior flexibilidade
                Validação no backend permite ambas as opções
            -->
            <div class="form-group">
                <label for="username">
                    <!-- Ícone de usuário para melhor UX -->
                    <i class="fas fa-id-card"></i> Matrícula ou Email
                </label>
                <div class="input-group">
                    <!-- Ícone dentro do input -->
                    <i class="fas fa-id-card input-icon"></i>
                    <!-- Campo de entrada com focus automático (autofocus) -->
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        placeholder="Digite sua matrícula ou email"
                        required
                        autofocus
                    >
                </div>
            </div>
            
            <!-- 
                CAMPO: PASSWORD
                Senha criptografada - nunca salva em sessions ou cookies
                Toggle de visibilidade implementado em JavaScript
            -->
            <div class="form-group">
                <label for="password">
                    <i class="fas fa-lock"></i> Senha
                </label>
                <div class="input-group password-field">
                    <!-- Ícone de cadeado -->
                    <i class="fas fa-lock input-icon"></i>
                    <!-- Input de password - mascarado por padrão -->
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="Digite sua senha"
                        required
                    >
                    <!-- Ícone de olho para toggle de visibilidade -->
                    <i class="fas fa-eye password-toggle" id="togglePassword" title="Mostrar senha"></i>
                </div>
            </div>
            
            <!-- 
                OPÇÃO: LEMBRAR-ME
                Mantém a sessão do usuário mesmo após fechar o navegador
                Utiliza cookie de sessão do Django
            -->
            <div class="remember-me">
                <input type="checkbox" id="remember" name="remember">
                <label for="remember">Lembrar-me nesta sessão</label>
            </div>
            
            <!-- 
                BOTÃO: SUBMIT
                Envia o formulário para autenticação
                Gradiente visual para destaque e Call-to-Action
            -->
            <button type="submit" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Entrar
            </button>
        </form>
        
        <!-- 
            ====================================================================
            USUÁRIOS DE TESTE (DESENVOLVIMENTO)
            ====================================================================
            Credenciais de teste para facilitar testes e demonstrações
        -->
        <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #002555;">
            <p style="color: #002555; font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem; text-align: center;">
                <i class="fas fa-vial"></i> Usuários de Teste
            </p>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.4rem; font-size: 0.7rem; color: #6d6e71;">
                <div><strong>Aluno:</strong> aluno.teste / aluno123</div>
                <div><strong>Monitor:</strong> monitor.teste / monitor123</div>
                <div><strong>Professor:</strong> professor.teste / professor123</div>
                <div><strong>Admin:</strong> admin / admin123</div>
            </div>
        </div>
        
        <!-- 
            ====================================================================
            SEÇÃO DE FOOTER
            ====================================================================
            Links adicionais: registro de novo usuário
            Convida usuários que não possuem conta a se cadastrar
        -->
        <div class="login-footer">
            <!-- Botão para ver vagas sem login -->
            <a href="{% url 'portal_vagas' %}" class="btn" style="
                width: 100%;
                padding: 0.75rem 1rem;
                background: transparent;
                color: #002555;
                border: 2px solid #002555;
                border-radius: 8px;
                font-size: 0.95rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-bottom: 1.5rem;
                display: inline-block;
                text-decoration: none;
                text-align: center;
            " onmouseover="this.style.background='#002555'; this.style.color='white';" 
               onmouseout="this.style.background='transparent'; this.style.color='#002555';">
                <i class="fas fa-briefcase"></i> Ver Vagas Disponíveis
            </a>
            
            <p style="text-align: center; color: #7f8c8d; font-size: 0.85rem;">
                <!-- Link para página de registro com tooltip -->
                Não tem conta? 
                <a href="{% url 'register' %}" style="color: #0097a7; text-decoration: none; font-weight: 600;">
                    <i class="fas fa-user-plus"></i> Crie aqui
                </a>
            </p>
        </div>
    </div>
    
    <!-- Bootstrap JavaScript - necessário para funcionamento de componentes Bootstrap -->
    <!-- CDN fornecido pela MaxCDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 
        ====================================================================
        SCRIPT: TOGGLE DE VISUALIZAÇÃO DE SENHA
        ====================================================================
        Permite ao usuário mostrar/ocultar a senha enquanto digita
        Melhora usabilidade sem comprometer segurança
        
        Funcionalidade:
        - Toggle entre type="password" e type="text"
        - Muda ícone entre olho fechado e aberto
        - Mantém foco no input após clicar
    -->
    <script>
        // Obter referências aos elementos do DOM
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        
        // Adicionar listener para clique no ícone de toggle
        togglePassword.addEventListener('click', function() {
            // Toggle do tipo de input entre password e text
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Toggle do ícone e título (tooltip) para feedback visual
            if (type === 'password') {
                // Se voltou para password, mostrar ícone de olho aberto
                this.classList.remove('fa-eye-slash');
                this.classList.add('fa-eye');
                this.setAttribute('title', 'Mostrar senha');
            } else {
                // Se mudou para text, mostrar ícone de olho fechado
                this.classList.remove('fa-eye');
                this.classList.add('fa-eye-slash');
                this.setAttribute('title', 'Ocultar senha');
            }
        });
        
        // Impedir que o clique no ícone tire o foco do input
        // mousedown é disparado antes de blur, prevenindo perda de foco
        togglePassword.addEventListener('mousedown', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
