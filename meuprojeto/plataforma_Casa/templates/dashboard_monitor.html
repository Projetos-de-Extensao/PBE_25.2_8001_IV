{% extends 'base.html' %}

{% block title %}Dashboard - Monitor{% endblock %}

{% block extra_css %}
<style>
    /* ========== CORES INSTITUCIONAIS ========== */
    :root {
        --primary-dark: #002555;
        --primary-light: #1245FF;
        --accent-gold: #F5AC00;
        --success-green: #28a745;
        --danger-red: #dc3545;
        --warning-yellow: #ffc107;
        --info-blue: #17a2b8;
        --gray-light: #f5f5f5;
        --gray-medium: #e9ecef;
        --gray-dark: #6c757d;
        --border-radius: 8px;
        --transition: all 0.3s ease;
    }

    /* ========== LAYOUT ========== */
    .dashboard-container {
        /* Removido o “modal”/overlay cinza: fundo transparente, layout mais limpo */
        background: transparent;
        min-height: auto;
        padding: 0 0 1.5rem 0;
    }

    /* ========== HEADER SECTION ========== */
    .dashboard-header {
        /* Cabeçalho minimalista usando as cores institucionais */
        background: linear-gradient(135deg, #0b2f5c 0%, var(--primary-light) 100%);
        color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        box-shadow: none;
        position: relative;
    }

    .dashboard-header::after {
        /* Fio dourado sutil sob o título */
        content: "";
        display: block;
        height: 3px;
        background: var(--accent-gold);
        border-radius: 2px;
        margin-top: 0.75rem;
        opacity: 0.9;
    }

    .dashboard-header h1 {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .dashboard-header p {
        font-size: 0.95rem;
        opacity: 0.95;
        margin-bottom: 0;
    }

    /* ========== KPI CARDS ========== */
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .kpi-card {
        background: #fff;
        border-radius: var(--border-radius);
        padding: 1.25rem;
        box-shadow: none; /* flat */
        border: 1px solid #e9edf5;
        border-left: 4px solid var(--accent-gold);
        transition: var(--transition);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .kpi-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
    }

    .kpi-card.monitorias {
        border-left-color: var(--primary-light);
    }

    .kpi-card.alunos {
        border-left-color: var(--success-green);
    }

    .kpi-card.horas {
        border-left-color: var(--accent-gold);
    }

    .kpi-card.pendentes {
        border-left-color: var(--warning-yellow);
    }

    .kpi-card.presenca {
        border-left-color: var(--info-blue);
    }

    .kpi-content {
        flex: 1;
    }

    .kpi-label {
        font-size: 0.85rem;
        color: var(--gray-dark);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .kpi-value {
        font-size: 1.7rem;
        font-weight: 800;
        color: var(--primary-dark);
    }

    .kpi-icon {
        font-size: 2.2rem;
        opacity: 0.15;
        text-align: right;
        color: var(--primary-dark);
    }

    /* ========== CONTENT CARDS ========== */
    .content-card {
        background: #fff;
        border-radius: var(--border-radius);
        padding: 1.25rem;
        box-shadow: none; /* flat */
        border: 1px solid #e9edf5;
        margin-bottom: 1.5rem;
        transition: var(--transition);
    }

    .content-card:hover {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--gray-light);
        margin-bottom: 1rem;
    }

    .card-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-icon {
        font-size: 1.3rem;
        color: var(--accent-gold);
    }

    /* ========== TABLE STYLING ========== */
    .table-responsive {
        overflow-x: auto;
    }

    .table {
        margin: 0;
        font-size: 0.9rem;
    }

    .table thead {
        /* Cabeçalho de tabela mais clean */
        background: #f7f9fc;
        color: var(--primary-dark);
        border-bottom: 1px solid #e9edf5;
    }

    .table thead th {
        border: none;
        padding: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.8rem;
    }

    .table tbody td {
        border: none;
        padding: 0.9rem 1rem;
        border-bottom: 1px solid var(--gray-medium);
    }

    .table tbody tr:hover {
        background: #f9fbff;
    }

    .table tbody tr:last-child td {
        border-bottom: none;
    }

    /* ========== BADGE STYLING ========== */
    .badge {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge-pendente {
        background: rgba(255, 193, 7, 0.15);
        color: #FFA000;
    }

    .badge-aprovado {
        background: rgba(40, 167, 69, 0.15);
        color: var(--success-green);
    }

    .badge-validado {
        background: rgba(23, 162, 184, 0.15);
        color: var(--info-blue);
    }

    .badge-ativo {
        background: rgba(40, 167, 69, 0.15);
        color: var(--success-green);
    }

    /* ========== EMPTY STATE ========== */
    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--gray-dark);
    }

    .empty-state-icon {
        font-size: 3rem;
        opacity: 0.3;
        margin-bottom: 1rem;
    }

    .empty-state-text {
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    /* ========== GRID LAYOUT ========== */
    .grid-2 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
        .kpi-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .grid-2 {
            grid-template-columns: 1fr;
        }

        .kpi-card {
            flex-direction: column;
        }

        .kpi-icon {
            margin-top: 0.5rem;
            text-align: left;
        }
    }

    /* ========== LIST STYLING ========== */
    .list-item {
        padding: 1rem;
        border-bottom: 1px solid var(--gray-medium);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
    }

    .list-item:hover {
        background: var(--gray-light);
    }

    .list-item:last-child {
        border-bottom: none;
    }

    .list-item-title {
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 0.3rem;
    }

    .list-item-meta {
        font-size: 0.85rem;
        color: var(--gray-dark);
    }

    /* ========== SECTION TITLE ========== */
    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary-dark);
        margin: 2rem 0 1.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-icon {
        color: var(--accent-gold);
        font-size: 1.4rem;
    }

    /* ========== PROGRESS BAR ========== */
    .progress {
        height: 8px;
        background: var(--gray-medium);
        border-radius: 10px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--accent-gold), var(--primary-light));
        border-radius: 10px;
        transition: var(--transition);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container">
    
    <!-- ========== HEADER ========== -->
    <div class="container-fluid">
        <div class="dashboard-header">
            <h1>
                <i class="fas fa-chart-line"></i> Dashboard do Monitor
            </h1>
            <p>
                <i class="fas fa-info-circle"></i> Visão geral das suas monitorias, horas e alunos
            </p>
        </div>
    </div>

    <!-- ========== KPI CARDS ========== -->
    <div class="container-fluid">
        <div class="kpi-grid">
            <!-- KPI 1: Monitorias Ativas -->
            <div class="kpi-card monitorias">
                <div class="kpi-content">
                    <div class="kpi-label">Monitorias Ativas</div>
                    <div class="kpi-value">{{ total_monitorias }}</div>
                </div>
                <div class="kpi-icon">
                    <i class="fas fa-book"></i>
                </div>
            </div>

            <!-- KPI 2: Total de Alunos -->
            <div class="kpi-card alunos">
                <div class="kpi-content">
                    <div class="kpi-label">Total de Alunos</div>
                    <div class="kpi-value">{{ total_alunos }}</div>
                </div>
                <div class="kpi-icon">
                    <i class="fas fa-users"></i>
                </div>
            </div>

            <!-- KPI 3: Horas Este Mês -->
            <div class="kpi-card horas">
                <div class="kpi-content">
                    <div class="kpi-label">Horas Este Mês</div>
                    <div class="kpi-value">{{ horas_este_mes }}h</div>
                </div>
                <div class="kpi-icon">
                    <i class="fas fa-clock"></i>
                </div>
            </div>

            <!-- KPI 4: Horas Pendentes -->
            <div class="kpi-card pendentes">
                <div class="kpi-content">
                    <div class="kpi-label">Horas Pendentes</div>
                    <div class="kpi-value">{{ horas_pendentes }}</div>
                </div>
                <div class="kpi-icon">
                    <i class="fas fa-hourglass"></i>
                </div>
            </div>

            <!-- KPI 5: Total de Horas -->
            <div class="kpi-card horas">
                <div class="kpi-content">
                    <div class="kpi-label">Total de Horas</div>
                    <div class="kpi-value">{{ total_horas }}h</div>
                </div>
                <div class="kpi-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
            </div>

            <!-- KPI 6: Taxa de Presença -->
            <div class="kpi-card presenca">
                <div class="kpi-content">
                    <div class="kpi-label">Taxa de Presença</div>
                    <div class="kpi-value">{{ taxa_presenca }}%</div>
                </div>
                <div class="kpi-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== GRID CONTENT ========== -->
    <div class="container-fluid">
        <div class="grid-2">
            
            <!-- ========== ÚLTIMOS REGISTROS DE HORAS ========== -->
            <div class="content-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-history card-icon"></i>
                        Últimos Registros de Horas
                    </div>
                    <a href="{% url 'meus_registros_horas' %}" class="btn btn-sm" style="border:1px solid #e0e6ef;color:#0b2f5c;">
                        Ver Todos
                    </a>
                </div>

                {% if ultimos_registros %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Monitoria</th>
                                <th>Data</th>
                                <th>Horas</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for registro in ultimos_registros %}
                            <tr>
                                <td>
                                    <strong>{{ registro.turma.nome }}</strong>
                                    <br>
                                    <small class="text-muted">{{ registro.turma.vaga.disciplina }}</small>
                                </td>
                                <td>{{ registro.data_registro|date:"d/m/Y" }}</td>
                                <td>{{ registro.duracao_horas }}h</td>
                                <td>
                                    {% if registro.validado %}
                                    <span class="badge badge-validado">
                                        <i class="fas fa-check"></i> Validado
                                    </span>
                                    {% else %}
                                    <span class="badge badge-pendente">
                                        <i class="fas fa-clock"></i> Pendente
                                    </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <p class="empty-state-text">Nenhum registro de horas encontrado</p>
                    <p style="font-size: 0.85rem;">
                        <a href="{% url 'registrar_horas' %}">Registrar horas agora</a>
                    </p>
                </div>
                {% endif %}
            </div>

            <!-- ========== MONITORIAS MAIS ATIVAS ========== -->
            <div class="content-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-fire card-icon"></i>
                        Monitorias Mais Ativas
                    </div>
                </div>

                {% if monitorias_ativas %}
                {% for monitoria in monitorias_ativas %}
                <div class="list-item">
                    <div style="flex: 1;">
                        <div class="list-item-title">{{ monitoria.nome }}</div>
                        <div class="list-item-meta">
                            <i class="fas fa-users"></i> {{ monitoria.participacaomonitoria_set.count }} alunos
                            • {{ monitoria.dias_da_semana }} • {{ monitoria.horario }}
                        </div>
                    </div>
                    <div>
                        <span class="badge badge-ativo">
                            <i class="fas fa-check-circle"></i> Ativa
                        </span>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <p class="empty-state-text">Nenhuma monitoria ativa no momento</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ========== TODAS AS MINHAS MONITORIAS ========== -->
    <div class="container-fluid">
        <h2 class="section-title">
            <i class="fas fa-list section-icon"></i>
            Todas as Minhas Monitorias
        </h2>

        <div class="content-card">
            {% if minhas_monitorias %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Monitoria</th>
                            <th>Disciplina</th>
                            <th>Horário</th>
                            <th>Sala</th>
                            <th>Alunos</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for monitoria in minhas_monitorias %}
                        <tr>
                            <td>
                                <strong>{{ monitoria.nome }}</strong>
                            </td>
                            <td>{{ monitoria.vaga.disciplina }}</td>
                            <td>
                                <small>{{ monitoria.dias_da_semana }}<br>{{ monitoria.horario }}</small>
                            </td>
                            <td>{{ monitoria.sala.numero }}</td>
                            <td>
                                <span class="badge" style="background: rgba(245, 172, 0, 0.15); color: #F5AC00;">
                                    {{ monitoria.participacaomonitoria_set.count }}
                                </span>
                            </td>
                            <td>
                                {% if monitoria.ativo %}
                                <span class="badge badge-ativo">
                                    <i class="fas fa-circle"></i> Ativa
                                </span>
                                {% else %}
                                <span class="badge" style="background: rgba(220, 53, 69, 0.15); color: #dc3545;">
                                    <i class="fas fa-circle"></i> Inativa
                                </span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'registrar_horas' %}" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-plus"></i> Registrar Horas
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-inbox"></i>
                </div>
                <p class="empty-state-text">Você ainda não tem nenhuma monitoria ativa</p>
                <p style="font-size: 0.85rem;">
                    Procure vagas no <a href="{% url 'portal_vagas' %}">Portal de Vagas</a>
                </p>
            </div>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    // Dados para gráficos podem ser adicionados aqui
    console.log('Dashboard do Monitor carregado com sucesso');
</script>
{% endblock %}
