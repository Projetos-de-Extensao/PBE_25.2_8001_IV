{% extends 'base.html' %}

{% block title %}Candidatar-se - {{ vaga.nome }}{% endblock %}

{% block extra_css %}
<style>
    /* Core Colors */
    :root {
        --color-primary-dark: #002555;
        --color-primary-light: #1245FF;
        --color-accent: #F5AC00;
        --color-off-white: #fafaf8;
        --color-success: #28a745;
        --color-gray-light: #f8f9fa;
        --color-gray-border: #e9ecef;
        --color-text-muted: #6c757d;
    }

    /* Page Header */
    .page-header {
        background: var(--color-primary-dark);
        color: var(--color-off-white);
        padding: 2rem;
        border-radius: 8px 8px 0 0;
        border-left: 4px solid var(--color-accent);
    }

    .page-header h1 {
        color: var(--color-off-white);
        font-weight: 700;
        font-size: 1.75rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    /* Main Card */
    .candidatura-card {
        background: white;
        border: 1px solid var(--color-gray-border);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 37, 85, 0.08);
    }

    /* Vaga Info Box */
    .vaga-info-box {
        background: linear-gradient(135deg, rgba(18, 69, 255, 0.08) 0%, rgba(0, 37, 85, 0.08) 100%);
        border: 2px solid var(--color-primary-light);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .vaga-info-box h4 {
        color: var(--color-primary-dark);
        font-weight: 700;
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .vaga-info-row {
        display: flex;
        align-items: center;
        padding: 0.5rem 0;
        color: var(--color-primary-dark);
    }

    .vaga-info-row i {
        color: var(--color-primary-light);
        width: 24px;
        margin-right: 0.75rem;
    }

    .vaga-info-row strong {
        min-width: 180px;
        font-weight: 600;
    }

    /* Section Title */
    .section-title {
        color: var(--color-primary-dark);
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 1.25rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--color-gray-border);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-title i {
        color: var(--color-primary-light);
    }

    /* Info Section */
    .info-section {
        background: white;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .info-block {
        margin-bottom: 1.25rem;
    }

    .info-block:last-child {
        margin-bottom: 0;
    }

    .info-block strong {
        color: var(--color-primary-dark);
        font-weight: 600;
        display: block;
        margin-bottom: 0.5rem;
    }

    .info-block p {
        color: #495057;
        line-height: 1.6;
        margin: 0;
    }

    /* Documents Section */
    .documents-section {
        background: var(--color-gray-light);
        padding: 1.75rem;
        border-radius: 8px;
        border: 1px solid var(--color-gray-border);
        margin-bottom: 1.5rem;
    }

    .upload-info {
        background: rgba(18, 69, 255, 0.08);
        border-left: 4px solid var(--color-primary-light);
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 4px;
        color: var(--color-primary-dark);
        font-size: 0.9rem;
    }

    /* Form Groups */
    .form-group-upload {
        background: white;
        padding: 1.25rem;
        border-radius: 8px;
        border: 2px solid var(--color-gray-border);
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .form-group-upload:hover {
        border-color: var(--color-primary-light);
        box-shadow: 0 2px 8px rgba(18, 69, 255, 0.1);
    }

    .form-label {
        color: var(--color-primary-dark);
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-label i {
        color: var(--color-primary-light);
    }

    .form-label .required {
        color: #dc3545;
    }

    .form-control {
        border: 2px solid var(--color-gray-border);
        border-radius: 6px;
        padding: 0.75rem 1rem;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        border-color: var(--color-primary-light);
        box-shadow: 0 0 0 3px rgba(18, 69, 255, 0.1);
    }

    .form-text {
        color: var(--color-text-muted);
        font-size: 0.85rem;
        margin-top: 0.5rem;
        display: block;
    }

    /* Checkbox */
    .termo-aceite {
        background: rgba(18, 69, 255, 0.08);
        border: 2px solid var(--color-primary-light);
        border-radius: 8px;
        padding: 1.25rem;
        margin-bottom: 1.5rem;
    }

    .form-check-input {
        width: 1.25rem;
        height: 1.25rem;
        margin-right: 0.75rem;
        border: 2px solid var(--color-primary-light);
        cursor: pointer;
    }

    .form-check-input:checked {
        background-color: var(--color-primary-light);
        border-color: var(--color-primary-light);
    }

    .form-check-label {
        color: var(--color-primary-dark);
        font-weight: 500;
        cursor: pointer;
        user-select: none;
    }

    /* Buttons */
    .btn-action {
        padding: 0.875rem 1.75rem;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .btn-submit {
        background: var(--color-primary-light);
        color: white;
        width: 100%;
        margin-bottom: 0.75rem;
    }

    .btn-submit:hover {
        background: var(--color-primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(18, 69, 255, 0.3);
    }

    .btn-voltar {
        background: var(--color-off-white);
        color: var(--color-primary-dark);
        border: 2px solid var(--color-gray-border);
        width: 100%;
    }

    .btn-voltar:hover {
        background: var(--color-primary-dark);
        border-color: var(--color-primary-dark);
        color: var(--color-off-white);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 37, 85, 0.2);
    }

    /* Breadcrumb */
    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 1.5rem;
    }

    .breadcrumb-item {
        color: var(--color-text-muted);
        font-size: 0.9rem;
    }

    .breadcrumb-item.active {
        color: var(--color-primary-dark);
        font-weight: 600;
    }

    .breadcrumb-item a {
        color: var(--color-primary-light);
        text-decoration: none;
        transition: all 0.2s;
    }

    .breadcrumb-item a:hover {
        color: var(--color-primary-dark);
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'dashboard' %}"><i class="fas fa-home"></i> Home</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'portal_vagas' %}"><i class="fas fa-briefcase"></i> Portal de Vagas</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Candidatar-se</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-9">
            <div class="candidatura-card">
                <!-- Header -->
                <div class="page-header">
                    <h1>
                        <i class="fas fa-user-plus"></i> Candidatar-se à Vaga
                    </h1>
                </div>

                <!-- Corpo do Card -->
                <div class="card-body p-4">
                    <!-- Informações da Vaga (Box Destacado) -->
                    <div class="vaga-info-box">
                        <h4>{{ vaga.nome }}</h4>
                        <div class="vaga-info-row">
                            <i class="fas fa-graduation-cap"></i>
                            <strong>Curso:</strong>
                            <span>{{ vaga.curso.nome }}</span>
                        </div>
                        <div class="vaga-info-row">
                            <i class="fas fa-book"></i>
                            <strong>Disciplina:</strong>
                            <span>{{ vaga.disciplina|default:"Não especificada" }}</span>
                        </div>
                        <div class="vaga-info-row">
                            <i class="fas fa-users"></i>
                            <strong>Vagas Disponíveis:</strong>
                            <span>{{ vaga.vagas_disponiveis }} de {{ vaga.numero_vagas }}</span>
                        </div>
                    </div>

                    <!-- Formulário de Candidatura -->
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}

                        <!-- Informações da Vaga -->
                        <div class="info-section">
                            <h5 class="section-title">
                                <i class="fas fa-info-circle"></i> Informações da Vaga
                            </h5>
                            
                            <div class="info-block">
                                <strong>Descrição:</strong>
                                <p>{{ vaga.descricao }}</p>
                            </div>
                            
                            <div class="info-block">
                                <strong>Requisitos:</strong>
                                <p>{{ vaga.requisitos }}</p>
                            </div>
                            
                            {% if vaga.responsabilidades %}
                            <div class="info-block">
                                <strong>Responsabilidades:</strong>
                                <p>{{ vaga.responsabilidades }}</p>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Documentos -->
                        <div class="documents-section">
                            <h5 class="section-title">
                                <i class="fas fa-file-upload"></i> Envio de Documentos
                            </h5>
                            
                            <div class="upload-info">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Histórico Escolar é obrigatório.</strong> Os demais documentos são opcionais mas recomendados. Formatos aceitos: PDF, DOC ou DOCX
                            </div>

                            <!-- Histórico Escolar -->
                            <div class="form-group-upload">
                                <label for="documento_historico_escolar" class="form-label">
                                    <i class="fas fa-graduation-cap"></i> 
                                    Histórico Escolar 
                                    <span class="required">*</span>
                                </label>
                                <input type="file" 
                                       class="form-control" 
                                       id="documento_historico_escolar" 
                                       name="documento_histórico_escolar" 
                                       accept=".pdf,.doc,.docx"
                                       required>
                                <small class="form-text">
                                    Envie seu histórico escolar atualizado
                                </small>
                            </div>

                            <!-- Currículo (Opcional) -->
                            <div class="form-group-upload">
                                <label for="documento_curriculo" class="form-label">
                                    <i class="fas fa-file-alt"></i> 
                                    Currículo 
                                    <span style="color: #6c757d; font-size: 0.85rem;">(Opcional)</span>
                                </label>
                                <input type="file" 
                                       class="form-control" 
                                       id="documento_curriculo" 
                                       name="documento_currículo" 
                                       accept=".pdf,.doc,.docx">
                                <small class="form-text">
                                    Envie seu currículo atualizado (opcional)
                                </small>
                            </div>

                            <!-- Carta de Motivação (Opcional) -->
                            <div class="form-group-upload">
                                <label for="documento_carta_de_motivacao" class="form-label">
                                    <i class="fas fa-envelope"></i> 
                                    Carta de Motivação 
                                    <span style="color: #6c757d; font-size: 0.85rem;">(Opcional)</span>
                                </label>
                                <input type="file" 
                                       class="form-control" 
                                       id="documento_carta_de_motivacao" 
                                       name="documento_carta_de_motivação" 
                                       accept=".pdf,.doc,.docx">
                                <small class="form-text">
                                    Explique sua motivação para ser monitor desta disciplina (opcional)
                                </small>
                            </div>
                        </div>

                        <!-- Termo de Aceite -->
                        <div class="termo-aceite">
                            <div class="form-check">
                                <input type="checkbox" 
                                       class="form-check-input" 
                                       id="termo" 
                                       required>
                                <label class="form-check-label" for="termo">
                                    Declaro que li e estou de acordo com os requisitos e responsabilidades da vaga <span class="required">*</span>
                                </label>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="d-grid">
                            <button type="submit" class="btn-action btn-submit">
                                <i class="fas fa-paper-plane"></i> Enviar Candidatura
                            </button>
                            <a href="{% url 'portal_vagas' %}" class="btn-action btn-voltar">
                                <i class="fas fa-arrow-left"></i> Voltar ao Portal
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Validação adicional de documentos obrigatórios
document.querySelector('form').addEventListener('submit', function(e) {
    // Verificar apenas o documento obrigatório: Histórico Escolar
    const historicoInput = document.getElementById('documento_historico_escolar');
    
    if (!historicoInput.files || historicoInput.files.length === 0) {
        e.preventDefault();
        alert('❌ Por favor, envie o Histórico Escolar (obrigatório)!');
        historicoInput.focus();
        return false;
    }
    
    // Verificar termo de aceite
    const termo = document.getElementById('termo');
    if (!termo.checked) {
        e.preventDefault();
        alert('❌ Por favor, aceite os termos e responsabilidades da vaga!');
        termo.focus();
        return false;
    }
    
    // Confirmação antes de enviar
    if (!confirm('✅ Confirma o envio da candidatura?\n\nDocumentos anexados:\n' +
                 '• Histórico Escolar: ' + historicoInput.files[0].name +
                 (document.getElementById('documento_curriculo').files.length > 0 ? '\n• Currículo: ' + document.getElementById('documento_curriculo').files[0].name : '') +
                 (document.getElementById('documento_carta_de_motivacao').files.length > 0 ? '\n• Carta de Motivação: ' + document.getElementById('documento_carta_de_motivacao').files[0].name : ''))) {
        e.preventDefault();
        return false;
    }
});

// Feedback visual ao selecionar arquivo
document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function() {
        const parent = this.closest('.form-group-upload');
        if (this.files && this.files.length > 0) {
            parent.style.borderColor = '#28a745';
            parent.style.backgroundColor = 'rgba(40, 167, 69, 0.05)';
            
            // Mostrar nome do arquivo selecionado
            let fileName = this.files[0].name;
            let small = parent.querySelector('.form-text');
            small.innerHTML = `<i class="fas fa-check-circle text-success"></i> Arquivo selecionado: <strong>${fileName}</strong>`;
            small.style.color = '#28a745';
        } else {
            parent.style.borderColor = '';
            parent.style.backgroundColor = '';
        }
    });
});

// Validar tamanho dos arquivos (máximo 5MB)
document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function() {
        if (this.files && this.files.length > 0) {
            const file = this.files[0];
            const maxSize = 5 * 1024 * 1024; // 5MB
            
            if (file.size > maxSize) {
                alert('❌ O arquivo ' + file.name + ' é muito grande!\n\nTamanho máximo: 5MB\nTamanho do arquivo: ' + (file.size / 1024 / 1024).toFixed(2) + ' MB');
                this.value = '';
                const parent = this.closest('.form-group-upload');
                parent.style.borderColor = '#dc3545';
                parent.style.backgroundColor = 'rgba(220, 53, 69, 0.05)';
            }
        }
    });
});
</script>
{% endblock %}
